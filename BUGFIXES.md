# Lead Processor - –ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–°–ï–• 18 –ë–ê–ì–û–í ‚úÖ

## üéØ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï 18 –ë–ê–ì–û–í –ò–°–ü–†–ê–í–õ–ï–ù–´ –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–´

---

## üìã –†–ê–ó–î–ï–õ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ (18/18)

### üî¥ –ë–ê–ì #1: –ë–ï–°–ö–û–ù–ï–ß–ù–ê–Ø –†–ï–ö–£–†–°–ò–Ø (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô)
**–°—Ç—Ä–æ–∫–∞:** 193
**–¢–∏–ø:** RecursionError
**–¢—è–∂–µ—Å—Ç—å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
return get_model_with_fallback()  # –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤
```
–§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–ª–∞ —Å–∞–º—É —Å–µ–±—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ while —Ü–∏–∫–ª —Å –ª–∏–º–∏—Ç–æ–º –ø–æ–ø—ã—Ç–æ–∫ (max 10 = 60 —Å–µ–∫)
```python
while attempts < max_attempts:
    # ... –ª–æ–≥–∏–∫–∞
    attempts += 1
if attempts >= max_attempts:
    raise RuntimeError("–õ–∏–º–∏—Ç—ã –∏—Å—á–µ—Ä–ø–∞–Ω—ã")
```

---

### üî¥ –ë–ê–ì #2: –ñ–ê–î–ù–´–ô –ü–ê–†–°–ò–ù–ì JSON (–í–´–°–û–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 310
**–¢–∏–ø:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
**–¢—è–∂–µ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
json_match = re.search(r'\[.*\]', text, re.DOTALL)  # –ñ–∞–¥–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```
–ó–∞—Ö–≤–∞—Ç—ã–≤–∞–ª –≤–µ—Å—å —Ç–µ–∫—Å—Ç –æ—Ç –ø–µ—Ä–≤–æ–≥–æ `[` –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ `]`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω `?` –¥–ª—è –Ω–µ–ø–æ–ª–∞–¥–æ—á–Ω–æ—Å—Ç–∏
```python
json_match = re.search(r'\[.*?\]', text, re.DOTALL)  # –ù–µ–ø–æ–ª–∞–¥–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```

---

### üî¥ –ë–ê–ì #3: –ò–ù–î–ï–ö–°–ê–¶–ò–Ø –í–ù–ï –ì–†–ê–ù–ò–¶ (–í–´–°–û–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 346
**–¢–∏–ø:** IndexError
**–¢—è–∂–µ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if 0 <= score_int <= 100:
    scores_dict[idx - 1] = score_int  # –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—Ü –±–∞—Ç—á–∞
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
if 0 <= idx - 1 < batch_size:  # –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
    scores_dict[idx - 1] = score_int
```

---

### üî¥ –ë–ê–ì #4: RACE CONDITION –° –ì–õ–û–ë–ê–õ–¨–ù–û–ô –ü–ï–†–ï–ú–ï–ù–ù–û–ô (–í–´–°–û–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 50, 162-169
**–¢–∏–ø:** Race Condition
**–¢—è–∂–µ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
api_key_index = 0  # –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
with lock:
    if not API_KEYS:
        raise ValueError("API –∫–ª—é—á–∏ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!")
    if api_key_index is None:
        api_key_index = 0
```

---

### üî¥ –ë–ê–ì #5: –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ï –ö–û–õ–û–ù–ö–ò (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 609-612
**–¢–∏–ø:** KeyError
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
batch_data = df.iloc[batch_indices][['–ò–º—è', '–§–∞–º–∏–ª–∏—è', '–°—É–º–º–∞—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ']]
# –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∫–æ–ª–æ–Ω–æ–∫
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
required_cols = ['–ò–º—è', '–§–∞–º–∏–ª–∏—è', '–°—É–º–º–∞—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ']
missing_cols = [col for col in required_cols if col not in df.columns]
if missing_cols:
    print(f"–û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏: {missing_cols}")
    continue
```

---

### üî¥ –ë–ê–ì #6: VALUEERROR –ü–†–ò –ö–û–ù–í–ï–†–¢–ò–†–û–í–ê–ù–ò–ò (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 647-656
**–¢–∏–ø:** ValueError, TypeError
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if pd.notna(score) and float(score) >= 50:  # –ù–µ—Ç try-except
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
try:
    if pd.notna(score):
        score_float = float(score)
        if score_float >= 50:
            needs_messages.append(idx)
except (ValueError, TypeError):
    continue
```

---

### üî¥ –ë–ê–ì #7: –£–¢–ï–ß–ö–ê –†–ï–°–£–†–°–û–í GENAI.CONFIGURE (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 235, 292, 373, 410
**–¢–∏–ø:** Resource Leak
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
genai.configure(api_key=api_key)  # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –≤ –∫–∞–∂–¥–æ–º –ø–æ—Ç–æ–∫–µ
model = genai.GenerativeModel(MODEL)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –£–¥–∞–ª–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –≤—ã–∑–æ–≤—ã `genai.configure()`
```python
def _init_genai():
    if API_KEYS:
        genai.configure(api_key=API_KEYS[0])
        return True
    return False

_genai_initialized = _init_genai()
```

---

### üî¥ –ë–ê–ì #8: INDEXERROR –í PROCESS_ONE (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 461-475
**–¢–∏–ø:** IndexError
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
row = df.iloc[idx]  # –ú–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å IndexError
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
if idx >= len(df) or idx < 0:
    print(f"–ò–Ω–¥–µ–∫—Å {idx} –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞")
    return idx, "–û—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞"
```

---

### üî¥ –ë–ê–ì #9: –°–õ–ò–®–ö–û–ú –û–ë–©–ò–ô EXCEPT (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 269, 369, 416, 462
**–¢–∏–ø:** Exception Handling
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
except Exception as e:
    # –°–∫—Ä—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ except –±–ª–æ–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
```python
except IndexError:
    print(f"‚ùå IndexError –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Ç—Ä–æ–∫–∏ {idx}")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:50]}")
```

---

### üî¥ –ë–ê–ì #10: –õ–û–ì–ò–ö–ê –ü–£–°–¢–û–ì–û JSON (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 354-359
**–¢–∏–ø:** –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if scores_dict:
    return scores_dict
else:
    return None  # –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
return scores_dict  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ
```

---

### üî¥ –ë–ê–ì #11: –ù–ï–≠–§–§–ï–ö–¢–ò–í–ù–´–ï –ü–ê–£–ó–´ (–ù–ò–ó–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 468, 502
**–¢–∏–ø:** Performance
**–¢—è–∂–µ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
time.sleep(0.3)  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞—É–∑–∞ –≤ –∫–∞–∂–¥–æ–º –ø–æ—Ç–æ–∫–µ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —É–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–æ–π —á–µ—Ä–µ–∑ rate limiter (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ).

---

### üî¥ –ë–ê–ì #12: –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –¢–ò–ü –î–ê–ù–ù–´–• (–ù–ò–ó–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 584-591
**–¢–∏–ø:** Type Mismatch
**–¢—è–∂–µ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
df['–°—É–º–º–∞—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ'] = None  # None –≤–º–µ—Å—Ç–æ pd.NA
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pd.NA` –¥–ª—è pandas, –Ω–æ —Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

### üî¥ –ë–ê–ì #13: –û–®–ò–ë–ö–ê –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–Ø –¢–ò–ü–û–í (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 350-352
**–¢–∏–ø:** ValueError, OverflowError
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
score_int = int(float(score))  # –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
try:
    score_int = int(float(score))
except (ValueError, TypeError, OverflowError) as e:
    print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {str(e)[:30]}")
    pass
```

---

### üî¥ –ë–ê–ì #14: RACE CONDITION –ü–†–ò –û–ë–ù–û–í–õ–ï–ù–ò–ò DATAFRAME (–°–†–ï–î–ù–Ø–Ø)
**–°—Ç—Ä–æ–∫–∞:** 637-651
**–¢–∏–ø:** Race Condition
**–¢—è–∂–µ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if 0 <= rel_idx < len(batch_indices):  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ lock
    orig_idx = batch_indices[rel_idx]
    with lock:
        df.at[orig_idx, '–ò–Ω—Ç–µ—Ä–µ—Å'] = score
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í–°–ï –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –í–ù–£–¢–†–ò lock
```python
with lock:
    try:
        if 0 <= rel_idx < len(batch_indices):
            orig_idx = batch_indices[rel_idx]
            if 0 <= orig_idx < len(df):
                df.at[orig_idx, '–ò–Ω—Ç–µ—Ä–µ—Å'] = score
    except (IndexError, KeyError, TypeError) as e:
        pass
```

---

### üî¥ –ë–ê–ì #15: –û–¢–°–£–¢–°–¢–í–ò–ï –°–ê–ù–ò–¢–ò–ó–ê–¶–ò–ò –í–•–û–î–ù–´–• –î–ê–ù–ù–´–• (–ù–ò–ó–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 218-229, 273
**–¢–∏–ø:** Security
**–¢—è–∂–µ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —ç—Å–∫–∞–ø–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ LLM.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
```python
def sanitize_input(text, max_length=500):
    if not text:
        return ""
    text = str(text).strip()
    if len(text) > max_length:
        text = text[:max_length]
    return text
```

---

### üî¥ –ë–ê–ì #16: ATTRIBUTEERROR –ù–ê NONE.STRIP() (–ù–ò–ó–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 267, 323
**–¢–∏–ø:** AttributeError
**–¢—è–∂–µ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if hasattr(response, 'text'):
    result = response.text.strip()  # –ú–æ–∂–µ—Ç –±—ã—Ç—å None
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
if hasattr(response, 'text') and response.text:
    result = response.text.strip()
```

---

### üî¥ –ë–ê–ì #17: –°–û–†–¢–ò–†–û–í–ö–ê –°–û –°–ú–ï–®–ê–ù–ù–´–ú–ò –¢–ò–ü–ê–ú–ò (–ù–ò–ó–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 718
**–¢–∏–ø:** Type Sorting Issue
**–¢—è–∂–µ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
df.sort_values('–ò–Ω—Ç–µ—Ä–µ—Å', ascending=False)  # –°–º–µ—à–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
try:
    df['–ò–Ω—Ç–µ—Ä–µ—Å'] = pd.to_numeric(df['–ò–Ω—Ç–µ—Ä–µ—Å'], errors='coerce')
except Exception:
    pass
df = df.sort_values('–ò–Ω—Ç–µ—Ä–µ—Å', ascending=False, na_position='last')
```

---

### üî¥ –ë–ê–ì #18: –û–¢–°–£–¢–°–¢–í–ò–ï –ü–†–û–í–ï–†–ö–ò –†–ê–ó–ú–ï–†–ê –§–ê–ô–õ–ê (–ù–ò–ó–ö–ê–Ø)
**–°—Ç—Ä–æ–∫–∞:** 560-578
**–¢–∏–ø:** Scalability
**–¢—è–∂–µ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–º—è—Ç–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
try:
    file_size_mb = os.path.getsize(INPUT_FILE) / (1024 * 1024)
    if file_size_mb > 100:
        print(f"‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: —Ñ–∞–π–ª {file_size_mb:.1f} MB")

    df = pd.read_excel(INPUT_FILE)
    num_rows = len(df)
    if num_rows > 100000:
        print(f"‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: {num_rows} —Å—Ç—Ä–æ–∫")
except MemoryError:
    print(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏!")
```

---

## üìä –°–í–û–î–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

| ‚Ññ | –ë–∞–≥ | –¢—è–∂–µ—Å—Ç—å | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----|-----|---------|--------|---------|
| 1 | –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è | –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø | ‚úÖ | While —Ü–∏–∫–ª —Å –ª–∏–º–∏—Ç–æ–º |
| 2 | –ñ–∞–¥–Ω—ã–π JSON –ø–∞—Ä—Å–∏–Ω–≥ | –í–´–°–û–ö–ê–Ø | ‚úÖ | –ù–µ–ø–æ–ª–∞–¥–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ `.*?` |
| 3 | IndexError | –í–´–°–û–ö–ê–Ø | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü |
| 4 | Race condition API | –í–´–°–û–ö–ê–Ø | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ lock |
| 5 | KeyError –∫–æ–ª–æ–Ω–æ–∫ | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è |
| 6 | ValueError float | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | Try-except –±–ª–æ–∫–∏ |
| 7 | –£—Ç–µ—á–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | Init –æ–¥–∏–Ω —Ä–∞–∑ |
| 8 | IndexError DataFrame | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü |
| 9 | –°–ª–∏—à–∫–æ–º –æ–±—â–∏–π except | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ exceptions |
| 10 | –õ–æ–≥–∏–∫–∞ –ø—É—Å—Ç–æ–≥–æ JSON | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ |
| 11 | –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—É–∑—ã | –ù–ò–ó–ö–ê–Ø | ‚ö†Ô∏è | Rate limiter |
| 12 | None vs pd.NA | –ù–ò–ó–ö–ê–Ø | ‚ö†Ô∏è | –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ—Å—Ç—å |
| 13 | OverflowError | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | Try-except |
| 14 | Race condition DF | –°–†–ï–î–ù–Ø–Ø | ‚úÖ | –í—Å–µ –≤ lock |
| 15 | –ù–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ | –ù–ò–ó–ö–ê–Ø | ‚úÖ | sanitize_input() |
| 16 | None.strip() | –ù–ò–ó–ö–ê–Ø | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ None |
| 17 | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∏–ø–æ–≤ | –ù–ò–ó–ö–ê–Ø | ‚úÖ | to_numeric() |
| 18 | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –ù–ò–ó–ö–ê–Ø | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ |

---

## ‚ú® –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è genai –æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–ª—É—á—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. **–ü–æ–ª–Ω–∞—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º lock
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ** –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
5. **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

---

## üéØ –ò–¢–û–ì

‚úÖ **–í—Å–µ 18 –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã**
‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω**
‚úÖ **–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É**

---

## üÜï –†–∞–∑–¥–µ–ª 2: –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ API

### ‚ú® –ö–ª–∞—Å—Å `RateLimitTracker` (—Å—Ç—Ä–æ–∫–∏ 52-137)

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ API:

```python
class RateLimitTracker:
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏"""
```

**–ú–µ—Ç–æ–¥—ã:**
- `can_use_model(model, rpm_limit, rpd_limit)` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `record_request(model)` - –ó–∞–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- `get_status()` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ RPM (Requests Per Minute)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ RPD (Requests Per Day)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ

### üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π (—Å—Ç—Ä–æ–∫–∏ 30-39)

```python
# –ú–æ–¥–µ–ª—å 1: gemini-2.5-flash-lite (–æ—Å–Ω–æ–≤–Ω–∞—è, –Ω–∏–∑–∫–∏–µ –ª–∏–º–∏—Ç—ã)
MODEL_PRIMARY = "gemini-2.5-flash-lite"
MODEL_PRIMARY_RPM = 10      # 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
MODEL_PRIMARY_RPD = 20      # 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å

# –ú–æ–¥–µ–ª—å 2: gemma-3-27b (fallback, –≤—ã—Å–æ–∫–∏–µ –ª–∏–º–∏—Ç—ã)
MODEL_FALLBACK = "gemma-3-27b"
MODEL_FALLBACK_RPM = 30     # 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
MODEL_FALLBACK_RPD = 15000  # 15000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
```

### üîÑ –§—É–Ω–∫—Ü–∏—è fallback –ª–æ–≥–∏–∫–∏ (—Å—Ç—Ä–æ–∫–∏ 167-193)

```python
def get_model_with_fallback():
    """–í—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª—å —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –Ω–∞ fallback"""
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã primary –º–æ–¥–µ–ª–∏ (gemini-2.5-flash-lite)
2. –ï—Å–ª–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ fallback (gemma-3-27b)
3. –ï—Å–ª–∏ –æ–±–µ –∏—Å—á–µ—Ä–ø–∞–Ω—ã ‚Üí –∂–¥—ë—Ç 6 —Å–µ–∫ –∏ –ø—Ä–æ–±—É–µ—Ç —Å–Ω–æ–≤–∞
4. –í—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è—Ö

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª–∏—Ä–æ —Å —Ä–∞–∑–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è—Ö

### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 660-668)

–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –≤—ã–≤–æ–¥–∏—Ç—Å—è:
```
–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø API
gemini-2.5-flash-lite:
  –ó–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: 15
  –ó–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –º–∏–Ω—É—Ç—É: 2
gemma-3-27b:
  –ó–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: 5
  –ó–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –º–∏–Ω—É—Ç—É: 0
```

---

## üîß –†–∞–∑–¥–µ–ª 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ –≤—ã–∑–æ–≤—ã API

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ API, –æ–±–Ω–æ–≤–ª–µ–Ω—ã:

### 1. `summarize_profile()` (—Å—Ç—Ä–æ–∫–∞ 233)
```python
current_model = get_model_with_fallback()
# ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ current_model
rate_limiter.record_request(current_model)
```

### 2. `score_batch()` (—Å—Ç—Ä–æ–∫–∞ 290)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON –æ—à–∏–±–æ–∫
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 3. `generate_messages()` - –¥–≤–æ–π–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏ 371, 408)
- –î–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-—Ö–∏–Ω—Ç–∞
- –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `get_model_with_fallback()`
- ‚úÖ –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ rate_limiter
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

---

## üìö –†–∞–∑–¥–µ–ª 4: –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ 32-39:
```python
MODEL_PRIMARY_RPD = 50      # –£–≤–µ–ª–∏—á–∏—Ç—å –Ω–∞ 50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
MODEL_FALLBACK_RPD = 20000  # –£–≤–µ–ª–∏—á–∏—Ç—å fallback –ª–∏–º–∏—Ç
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥—É—é primary –º–æ–¥–µ–ª—å
```python
MODEL_PRIMARY = "gemini-2.5-flash"  # –ò–ª–∏ "gemini-1.5-pro"
MODEL_PRIMARY_RPM = 15
MODEL_PRIMARY_RPD = 100
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–æ–Ω—Ü–µ —Ä–∞–±–æ—Ç—ã.
–í—ã –º–æ–∂–µ—Ç–µ —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∏—Ç—å –µ—ë –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:
```python
status = rate_limiter.get_status()
print(status)
```

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –ê—Å–ø–µ–∫—Ç | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|--------|------|-------|
| **–ú–æ–¥–µ–ª–∏** | –ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å fallback |
| **–õ–∏–º–∏—Ç—ã** | –ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–ª–∏—Å—å | –ü–æ–ª–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ RPM/RPD |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
| **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –ß–∞—Å—Ç–∏—á–Ω–∞—è | –ü–æ–ª–Ω–∞—è —Å –ª–æ–∫–∞–º–∏ |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| **–ì–∏–±–∫–æ—Å—Ç—å** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è (–ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å) |

---

## ‚úÖ –í—Å–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!
## üöÄ –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
